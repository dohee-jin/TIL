## TIL - 2025.07.17

### ğŸ” ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©

#### ìŠ¤í”„ë§: íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬, ë§ˆë¦¬ì•„ DB ì„¤ì¹˜ ë° ì—°ê²°, ìŠ¤í”„ë§ JDBC, 

**íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬**   
íŒŒì¼ ì—…ë¡œë“œ: í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œì»¬ íŒŒì¼(ì´ë¯¸ì§€, ë¬¸ì„œ, ë™ì˜ìƒ ë“±)ì„ ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ì‘ì—….   
ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œëŠ” MultipartFile ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—…ë¡œë“œë¥¼ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬í•¨   

ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬í•˜ê¸°   

1. íŒŒì¼ ì—…ë¡œë“œ ì§€ì›ì„ ìœ„í•´ multipart ìš”ì²­ì„ í™œì„±í™”
```
// application.yml ì— í•´ë‹¹ ë‚´ìš© ì¶”ê°€
spring:
  servlet:
    multipart:
      max-file-size: 10MB 
      max-request-size: 100MB

// í´ë¼ì´ì–¸íŠ¸ê°€ ì˜¬ë¦° íŒŒì¼ë“¤ì„ ì €ì¥í•  ë£¨íŠ¸ ì§€ì •
file:
  upload:
    location: ${user.home}/spring/upload/
```
- max-file-size: ì—…ë¡œë“œí•  íŒŒì¼ 1ê°œì˜ ìµœëŒ€ ìš©ëŸ‰ì„ ì œí•œ
- max-request-size: í•œë²ˆì— ì—…ë¡œë“œí•  ìˆ˜ ìˆëŠ” íŒŒì¼ì˜ ì´ ìš©ëŸ‰

application.properties: í‚¤, ë°¸ë¥˜ ìŒìœ¼ë¡œ ë°ì´í„°ë¥¼ ê´€ë¦¬      
application.yml: ì„¤ì •ì„ ë‹¨ê³„ì ìœ¼ë¡œ ì‘ì„±í•˜ì—¬ ê´€ë¦¬ë¥¼ ìš©ì´í•˜ê²Œ í•¨
```
// application.properties
spring.servlet.multipart.max-file-size=10MB  
spring.servlet.multipart.max-request-size=100MB

// application.yml
// . ì„ ë‹¤ : ìœ¼ë¡œ ë³€ê²½
spring:
  servlet:
    multipart:
      max-file-size: 10MB 
      max-request-size: 100MB
```

2. íŒŒì¼ ì—…ë¡œë“œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ì‘ì„±   
MuliparteFile ì£¼ìš” ë©”ì†Œë“œ   
- getOriginalFilename(): ì—…ë¡œë“œëœ íŒŒì¼ì˜ ì›ë˜ ì´ë¦„ì„ ë°˜í™˜.
- getSize(): íŒŒì¼ í¬ê¸°ë¥¼ ë°˜í™˜.(ë°”ì´íŠ¸ ë‹¨ìœ„)
- getContentType(): íŒŒì¼ì˜ MIME íƒ€ì… ë°˜í™˜.
- isEmpty(): ë¹„ì–´ìˆëŠ” íŒŒì¼ì¸ì§€ ì—¬ë¶€ í™•ì¸.
- transferTo(File dest): íŒŒì¼ì„ ì €ì¥ëœ ìœ„ì¹˜ë¡œ ì €ì¥

```
// íŒŒì¼ ì—…ë¡œë“œ ìš”ì²­ -> POST ë§¤í•‘
@PostMapping("/uploads")
public ResponseEntity<?> uploadSingleFile (
  @RequsetParam("file")
  MultipartFile originFile // MultiparteFile ê°ì²´ë¥¼ ì‚¬ìš©
) {
    // ì—…ë¡œë“œí•œ íŒŒì¼ ì´ë¦„ í™•ì¸
    log.info("upload file name: {}", originFile.getOriginalFilename());
    // ì—…ë¡œë“œí•œ íŒŒì¼ì˜ íƒ€ì…, ë©”íƒ€ë°ì´í„° í™•ì¸
    log.info("upload file name: {}", originFile.getContentType());

    return ResponseEntity.ok();
}
```
í¬ìŠ¤íŠ¸ë§¨ìœ¼ë¡œ íŒŒì¼ ì—…ë¡œë“œí•˜ê¸°   
post > body >  @RequestParam("file") ì— ì‘ì„±í–ˆë˜ fileì„ í‚¤ì— ì…ë ¥ >    
value ë¥¼ fileë¡œ ì„ íƒ í›„ select file > New file from local machine > íŒŒì¼ì—…ë¡œë“œ   
![alt text](image-1.png)   

3. ë¡œì»¬(ì„œë²„)ì— íŒŒì¼ ì €ì¥í•˜ê¸°   
application.ymlì— ì‘ì„±í–ˆë˜ ë£¨íŠ¸ê²½ë¡œì— íŒŒì¼ ìƒì„±
```
// application.yml
file:
  upload:
    location: ${user.home}/spring/upload/
```
ì§€ì •í•œ ê²½ë¡œë¥¼ ê´€ë¦¬í•˜ëŠ” ì„¤ì • íŒŒì¼(í´ë˜ìŠ¤) ìƒì„±
```
// config.FileUploadConfig
@Getter
@Configuration // ì´ ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ìœ¼ë©´ ë…¼ë¦¬ì ìœ¼ë¡œ ì„¤ì • íŒŒì¼ë¡œ ì¸ì‹
public class FileUploadConfig {

  // application.yml íŒŒì¼ ë£¨íŠ¸ ê²½ë¡œ ì½ì–´ì˜¤ê¸°
  private String location = 'C/~~'; 
  â€» ì´ë ‡ê²Œ ì‘ì„±í•˜ë©´ ì •ë³´ ë‹¤ í„¸ë¦¼. ì„¤ì •íŒŒì¼ë¡œë¶€í„° ì£¼ì†Œë¥¼ ì…ë ¥ë°›ì•„ì•¼ í•¨

  @Value("${file.upload.location}")
  private String location;

  // ë£¨íŠ¸ ê²½ë¡œê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì—†ìœ¼ë©´ ìƒì„±
  @PostConstructor // ë¹ˆì´ ìƒì„±ë˜ëŠ” ìˆœê°„(ì„œë²„ ì¼œì§ˆ ë•Œ) ìë™ìœ¼ë¡œ 1íšŒ ì‹¤í–‰
  public void init() {
    File directory = new File(location)
    if(!directory.exists()) directory.mkdirs();
  }
}
```
íŒŒì¼ ì €ì¥í•˜ê¸°
```
@RequiredArgsConstructor
{
  // @configruation ë„ @componentë¡œ ìŠ¤í”„ë§ì´ ê´€ë¦¬í•¨
  privat final FileUploadCongif fileUploadConfig;

  public ResponseEntity<?> uploadSingleFile () {

    // ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ê°€ì ¸ì˜¤ê¸°
    String rootDir = fileUploadConfig.getLocation();

    // íŒŒì¼ëª… ê°€ì ¸ì˜¤ê¸°
    String originalFilename = originFile.getOriginalFilename();
    // í™•ì¥ìë§Œ ë¶„ë¦¬í•˜ê¸°
    String extension = originalFilename.substring(originalFilename.lastIndexOf("."));
    // íŒŒì¼ëª… ëœë¤í•˜ê²Œ ë³€ê²½í•˜ê¸°
    // íŒŒì¼ ì´ë¦„ì— ../ì™€ ê°™ì€ ê²½ë¡œ ì¡°ì‘ ë¬¸ìì—´ì´ í¬í•¨ë˜ì§€ ì•Šë„ë¡ ë³´ì•ˆì„ ê³ ë ¤í•´ì•¼í•œë‹¤.
    String filename = UUID.randomUUID().toString() + extension;

    String fullName = rootDir + filename;
    File uploadedLocation = new File(fullName);

    // íŒŒì¼ ì „ì†¡
    try {
        ogriginFile.transferTo(uploadedLocation) // uploadedLocationìœ¼ë¡œ ì—…ë¡œë“œëœ íŒŒì¼ì„ ì´ë™
    } catch (IOException e) {
        return ResponseEntity.internalServerError().body("íŒŒì¼ ì €ì¥ ì‹¤íŒ¨!");
    }

    return ResponseEntity.ok();

  }
}
```

4. ë‹¤ì¤‘íŒŒì¼ ì…ë ¥ë°›ê¸°   
ë‹¤ì¤‘íŒŒì¼ì€ íŒŒë¼ë¯¸í„°ë¥¼ List<MultipartFile> ë¡œ ì…ë ¥ë°›ê³  ì €ì¥í• ë•Œ ë°˜ë³µë¬¸ì„ í™œìš©í•˜ì—¬    
í•˜ë‚˜ì”© êº¼ë‚¸ í›„ ë‹¨ì¼íŒŒì¼ì—ì„œ íŒŒì¼ëª… ë³€ê²½í•˜ê³  ì „ì†¡í•œ ë‚´ìš©ì„ ë°˜ë³µí•˜ë©´ ëœë‹¤.
```
@PostMapping("/uploads")
public ResponseEntity<?> uploadSingleFile (
  @RequsetParam("files")
  List<MultipartFile> originFiles 
  .
  .
  .
  
  for(MultipartFile originFile : originFiles) {
    .
    .
    .
  }
)
```

5. ì—…ë¡œë“œí•œ íŒŒì¼ì— ì ‘ê·¼í•˜ê¸°   
WebMvcConfigurerë¥¼ í™œìš©
```
@Configuration
@RequiredArgsConstructor
public class WebResourceConfig implements WebMvcConfigurer {
  
  private final FileUploadConfig fileUploadConfig;

  @Override
  public void add ResourceHandlers(ResourceHandlerRegistry registry){
        /*
            íŒŒì¼ ì„œë²„ì— ì €ì¥ëœ C:/Users/user/spring/upload ì•ˆì— ë“¤ì–´ìˆëŠ” íŒŒì¼ë“¤ì„
            ë°±ì—”ë“œì„œë²„ì—ì„œ http://localhost:9000/uploads/íŒŒì¼ëª… -> í–ˆì„ ë•Œ êº¼ë‚´ì£¼ê² ë‹¤.
         */
        registry.addResourceHandler("/uploads/**")
                .addResourceLocations("file:" + fileUploadConfig.getLocation());
    }

}
```
- addResourceHandler: /uploads/**, http:~/uploads/ ë¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ì„ ì²˜ë¦¬
- addResourceLocations: file: ì ‘ë‘ì‚¬ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ ì‹œìŠ¤í…œ ê²½ë¡œë¥¼ ì§€ì •   


**ìŠ¤í”„ë§ JDBC**   
JDBC   
ìë°” ì–¸ì–´ë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ìë°” API   

ìŠ¤í”„ë§ JDBC   
ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” JDBC ëª¨ë“ˆ(ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” JDBC ì¶”ìƒí™” ë¼ì´ë¸ŒëŸ¬ë¦¬)   
JDBC ì½”ë“œë¥¼ ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ê³  ë” ì‰½ê²Œ ë°ì´í„°ë² ì´ìŠ¤ì™€ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ì—­í•    

ìŠ¤í”„ë§ JDBC ì‘ì„±   
1. í…Œì´ë¸” ìƒì„± ë° ì—”í‹°í‹° ìƒì„±
í…Œì´ë¸”ì„ ìƒì„± í›„ í…Œì´ë¸”ê³¼ ì—°ê²°ë  ì—”í‹°í‹°ë¥¼ ì‘ì„±í•œë‹¤. ì—”í‹°í‹°ì˜ í•„ë“œëª…ì€ í…Œì´ë¸”ì˜ ì¹¼ëŸ¼ëª…ê³¼ ë™ì¼í•˜ê²Œ ë§Œë“¤ë˜   
ìë°”ì˜ ë¬¸ë²•ì„ ë”°ë¼ì•¼ í•œë‹¤.(í…Œì´ë¸”: ìŠ¤ë„¤ì´í¬ì¼€ì´ìŠ¤ -> ìë°”: ì¼€ë©€ì¼€ì´ìŠ¤) ë™ì¼í•˜ê²Œ ì‘ì„±í•˜ë©´ ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ë§¤ì¹­í•´ì¤Œ
```
/*
   book í…Œì´ë¸” êµ¬ì¡°
   | id | title | author | isbn | available | created_at |
   |----|-------|--------|------|-----------|------------|
   |    |       |        |      |           |            |
*/
// entity
public class Book {

  private Long id;
  private String title;
  private String author;
  private String isbn;
  private boolean available;
  // â€» ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤ë¡œ ì‘ì„±ëœ db ì¹¼ëŸ¼ëª…ì„ ìë°”ì—ì„œëŠ” ìºë©€ì¼€ì´ìŠ¤ë¡œ ì‘ì„±
  private LocalDateTime createAt;

}
```
2. 







#### SQL: SELECT