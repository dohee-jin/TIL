## TIL - 2025.08.05

### 🔍 오늘 배운 내용

#### 종합 복습 1. - 토이 프로젝트(여행기록관리): 초기 생성   

> 종합 복습을 위한 여행기록관리 토이프로젝트 생성   

#### 프로젝트 생성(인텔리제이 기준)
```
1. new > project > spring boot 선택

2. 프로젝트 이름, 저장경로, 언어, 빌더 타입, 그룹, 아티팩트(프로젝트 이름), 패키지이름(도메인), 기타 기본 설정(jdk, 자바 버전, 패키징) 설정대로 설정

3. spring boot 버전 선택(3.5.4 / 3.4.8 .. 요구사항에 맞는 버전 선택)

4. 의존성 필요한 모듈 선택
   * Developer Tools
     - Spring Boot DevTools
     - Lombok
   * Web
     - Spring Web
   * Template Engines(선택, jsp는 따로 추가해야 됨)
     - Thymeleaf 
   * Security
     - Spring Security(프로젝트 생성 후 추가 가능)
   * Spring DATA JPA
     - Spring Data JPA
     - Maria DB Driver

5. HELP.md -> README.md로 이름 변경, .gitignore 작성

.gitignore 에 .idea/ 추가

6. application.properties -> .yml로 이름 변경   

7. db 연결
```

**파일 구조**
```
project/
├── build.gradle or pom.xml         # 빌드 스크립트 (Gradle 또는 Maven)
├── .gitignore                      # Git 버전 관리에서 제외할 파일 목록
├── README.md                       # 프로젝트 설명 및 안내 문서
│
└── src/
    ├── main/
    │   ├── java/
    │   │   └── com/spring/toyproject
    │   │       ├── api/            # API 엔드포인트 및 웹 요청 처리
    │   │       ├── config/         # 
    │   │       ├── domain/         # 도메인 엔티티 (User, Meeting, Participant 등)
    │   │       ├── exception/      # 전역 및 커스텀 예외 처리
    │   │       ├── jwt/            # 
    │   │       ├── repository/     # API 엔드포인트 및 웹 요청 처리
    │   │       ├── routes/         # 
    │   │       └── service/        # 비즈니스 로직 처리 계층
    │   │
    │   └── resources/
    │       ├── application.yml     # 애플리케이션 환경설정 파일
    │       ├── static/             # 정적 리소스 (CSS, JavaScript, 이미지 등)
    │       └── templates/          # 서버 사이드 뷰 템플릿 (Thymeleaf, JSP 등)
    │
    │
    ├── test/
```

**html 공통코드(head ,header, footer 분리)**
```
// head
<head th:replace="{layout/head::별칭}"></head>

// header
<header th:replace="~{layout/header::별칭}"></header>

// header
<footer th:replace="~{layout/footer::별칭}"}</footer>
```
layout 폴더 생성 후 head, header, footer 파일 생성   
생성된 각각의 파일에 아래의 내용 작성
```
<태그이름 class="" th:fragment="별칭"></태그이름>
```
---

#### 엔터티(domain > entity), 레포지토리(repository > Repository) 작성
**사용자 엔터티 생성**   
인증 시스템의 핵심 엔터티로 기본 사용자의 정보를 관리할 엔터티를 작성   

엔터티 객체는 db와 직접적으로 소통하는 객체로 외부에서 new ~ 로 생성되거나 값을 수정할 수 없도록   
@NoArgsConstructor(access = AccessLevel.PROTECTED) 로 설정한다. 
```
@Entity
@Table(table = "")
...
@NoArgsConstructor(access = AccessLevel.PROTECTED)  // 롬복 사용 o
public class User {

    // 롬복 사용 x
    protected User(){}
}
```

비밀번호 칼럼의 길이는 255로 한다.   
패스워드는 사용자가 지정한 일정 범위 안의 길이어도   
암호화 되어 해시로 db에 저장되기 때문에 길이를 크게 잡는다. 
```
{
    ...
    @Column(name = "password", nullable = false, length = 255;)
    private String password;
}
```

모든 테이블에는 생성시간, 마지막 수정시간이 필수이며   
실무적 측면에서는 생성한 사람, 마지막으로 수정한 사람의 정보도 기입한다.
```
{
    ...
    @CreationTimestamp
    @Column(nullable = false, updatable = false)
    private LocalDateTime createAt;
    
    @UpdateTimestamp // 업데이트 문이 동작하면 자동으로 시간을 저장
    @Column(nullable = false)
    private LocalDateTime updateAt;
}
```

사용자 엔터티는 필수로 받아야 할 필드와 받지 않아도 되는 필드,   
수정되서는 않되는 필드가 있기 때문에 @Builder, @AllArgsConstructor 사용보다는   
직접 필요한 필드 값만 입력받는 생성자를 생성한다.
```
{
    @Builder // 여기에 빌더를 적용
    public User(){
    }
}
```

서버를 실행시키면 작성된 엔터티로 테이블이 생성된다.   
원래는 직접 테이블을 설계하고 db에 작성해야 된다는 것을 생각해야 된다.   

**레포지토리 작성**   
레포지토리는 인터페이스로 작성하고 JpaRepository 를 상속받는다.   
해당 레포지토리는 <1, 2> 두가지의 제너릭 타입을 받는다.   
첫번째는 엔터티를 받고 두번째는 기본키의 타입을 받는다.
```
public interface 레포지토리 이름 extends JpaRepository<엔터티 타입, 기본키 타입> {
}
```


JpaRepository 는 기본적인 CRUD 기능을 제공한다.   
추가하고 싶은 기능이 있을 시 규칙에 맞게 메소드 이름을 지어주면   
쿼리를 자동으로 생성해준다.
```
public interface UserRepository extends JpaRepository<User, Long> {

    Optional<User> findByUsername(String Username); // 이름으로 찾기
    Optional<User> findByEmail(String email); // 이메일로 찾기
}
```

복잡한 쿼리의 경우 직접 @Query() JPQL / 네이티브로 작성하면 된다.

---

#### 레포지토리 단위 테스트
**build gradle**   
빌드 그레이들 dependencies 에 아래 내용 추가   
가벼운 내장 db. 테스트용으로 사용한다.
```
testRuntimeOnly 'com.h2database:h2'
```

**resources**
테스트 폴더 아래 resources 폴더를 생성한다.   
resources 폴더 안에 application-test.yml 파일을 생성한다.   
테스트 시에는 main 의 yml 파일 대신 test 의 yml 파일을 읽는다.
```
    ├── test/
    │   ├── java/
    │   │ 
    │   ├── resources/
    │   │    └── application-test.yml         
```

**테스트 파일 작성**   
@DataJpaTest: @SpringBootTest 대신 @DataJpaTest 어노테이션을 사용한다.   
@ActiveProfiles("test"): application-test.yml 을 읽도록 설정
```
@DataJpaTest
@ActiveProfiels("test")
class Repository {
    @Autowired
    의존 객체 주입
    
    // 테스트 코드 실행 전 먼저 실행될 코드
    // db에 들어있는 정보가 없어서 테스트를 위해
    // 더미 데이터를 생성하기 위해 사용
    @BeforeEach
    void setUp() {
        
    }
     
    @Test
    @DisplayName("")
    void testName() {
    
        // given
        // when
        // then
    
    }
}

```









