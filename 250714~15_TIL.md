## TIL - 2025.07.14 ~ 15

### π” μ¤λ λ°°μ΄ λ‚΄μ©

#### μ¤ν”„λ§: λ©”μ†λ“ μ”μ²­Β·μ‘λ‹µ μ²λ¦¬, Restful API κµ¬ν„, RequestBody,ν¬μ¤νΈλ§¨ μ„¤μΉ, λΉλ” ν¨ν„΄, Cors(μ „μ—­ ν¬λ΅μ¤ μ¤λ¦¬μ§„ μ„¤μ •), RequestEntity,  Model view

**λ©”μ†λ“ μ”μ²­Β·μ‘λ‹µ μ²λ¦¬**
- @RequestParam("")   
μΏΌλ¦¬ λ§¤κ°λ³€μ. μ”μ²­ URLμ μΏΌλ¦¬ νλΌλ―Έν„°λ¥Ό λ©”μ†λ“ νλΌλ―Έν„°μ— λ°”μΈλ”©ν•λ” λ° μ‚¬μ©.    
νλΌλ―Έν„°κ°€ ν•„μμΈμ§€ μ—¬λ¶€λ¥Ό μ„¤μ • κ°€λ¥ν•λ©° κΈ°λ³Έκ°’λ„ μ •μ κ°€λ¥
```
// κΈ°λ³ΈURl?id(@RequestParam λ‚΄μ©)=1&(μµμ…μΌλ΅ λ°›κ² λ‹¤λ” νλΌλ―Έν„° μ΄μ–΄μ„ μ‘μ„±)price=99999
// http://localhost:9000?id=1&price=100000(priceλ” μµμ… νλΌλ―Έν„°λ΅ κΈ°λ³Έκ°’μ€ 100000μ΄κ³  κ°’μ΄ μ—†μ–΄λ„ λ™μ‘ν•¨.)

// νλΌλ―Έν„°λ΅ ν•΄λ‹Ήν•λ” λ‚΄μ©λ§ ν™•μΈν•΄μ„ μ‘λ‹µ
@GetMapping
public <νƒ€μ…> get(
    // ν•„μλ΅ μ…λ ¥λ°›μ•„μ•Ό λλ” νλΌλ―Έν„°
    //  @RequestParam("id") Long id λ³€μλ…κ³Ό νλΌλ―Έν„° λ…μ΄ λ™μΌν•λ©΄ μƒλµ κ°€λ¥
    Long id, 
    // νλΌλ―Έν„°λ¥Ό μµμ…μΌλ΅ λ°›κΈ° 
    // @RequestParam(value = "", required = false, ...)
    @RequestParam(value = "price", required = false, defaultValue = 10000) int price) {
        return "" ;
    }
``` 
- @PathVariable("")   
κ²½λ΅ λ³€μ. URL κ²½λ΅μ μΌλ¶€λ¥Ό λ³€μλ΅ μ‚¬μ©ν•  λ• μ‚¬μ©ν•λ” μ–΄λ…Έν…μ΄μ….   
κ²½λ΅μ—μ„ κ°’μ„ μ¶”μ¶ν•΄ μ»¨νΈλ΅¤λ¬ λ©”μ†λ“ νλΌλ―Έν„°λ΅ μ „λ‹¬.
```
// @PathVariable("id") Long id λ” λ³€μλ…μ΄λ‘ νλΌλ―Έν„° λ…μ΄ λ™μΌν•λ©΄  κ΄„νΈ κΉμ§€λ” μƒλµκ°€λ¥ν•μ§€λ§ @PathVariableμ€ μƒλµν•λ©΄ μ•λλ‹¤. 

@GetMapping("/{id}")
public <νƒ€μ…> get(@PathVariable Long id) { 
    return "" ;
} 
```   
Http μ”μ²­ λ©”μ†λ“ ν…μ¤νΈ λ°©λ²•   
- ν„°λ―Έλ„
```
// window
>> curl.exe -X [GET | POST | PUT | DELETE] [URL]?query  
```
- λΈλΌμ°μ € μ½μ†”
```
fetch('url', {
    method: 'http μ”μ²­ λ©”μ†λ“',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        // POST μ”μ²­ λ³΄λ‚Ό JSON λ‚΄μ© μ‘μ„±
    })
    }) // fetch('url') λ΅ μ‘μ„±ν•λ©΄ GET μ”μ²­
    .then(res => res.json()); // json or λ°›μ„ νƒ€μ…
    .then(data => console.log(data))
```
- ν¬μ¤νΈλ§¨   

**RESTul API κµ¬ν„**   
REST(Representational State Transfer):   
μμ›μ„ κΈ°λ°μΌλ΅ μμ›μ μƒνƒλ¥Ό ν‘ν„ν•κ³  μ „μ†΅ν•λ” λ°©λ²•μ„ μ •μ   
RESTful μ„λΉ„μ¤λ” RESTμ μ›μΉ™μ„ μ¤€μν•μ—¬ μ„¤κ³„λ μ›Ή μ„λΉ„μ¤λ¥Ό μλ―Έ   

RESTful μ„λΉ„μ¤μ μ¥μ    
- ν™•μ¥μ„±: ν΄λΌμ΄μ–ΈνΈμ™€ μ„λΉ„μ λ…λ¦½μ„±μ„ μ μ§€ν•μ—¬ ν™•μ¥μ΄ μ©μ΄
- μ μ—°μ„±: λ‹¤μ–‘ν• ν”λ«νΌ ν™μ© κ°€λ¥, μ–Έμ–΄λ‚ κΈ°μ μ— μΆ…μ†λμ§€ μ•μ
- μ„±λ¥ ν–¥μƒ: μΊμ‹λ¥Ό ν†µν• μ„±λ¥ μµμ ν™” κ°€λ¥
- μΌκ΄€μ„±: ν‘μ¤€ HTTP λ©”μ†λ“μ™€ URI μ„¤κ³„λ¥Ό λ”°λ¦„μΌλ΅ μ΄ν•΄ν•κΈ° μ‰¬μ›€   

RESTful μ”μ²­ μ²λ¦¬: @RestController 
- κΈ°μ΅΄μ— μ‘μ„±ν•λ @Controller λ€μ‹ μ— @RestControllerλ΅ μ‘μ„±ν•λ‹¤ 
- @RestControllerλ” @ResponseBodyκ°€ ν¬ν•¨λ„μ–΄ μμ–΄ λ”°λ΅ μ‘μ„±ν•μ§€ μ•μ•„λ„ λλ‹¤.
- @Controllerλ” λ©”μ†λ“μ λ°ν™ κ°’μΌλ΅ JSP λ·°λ¥Ό ν•Έλ“¤λ§
- @RestController λ” λ°ν™ κ°’μ„ JSON, XML λ“±μΌλ΅ μ§λ ¬ν™”ν•μ—¬ ν΄λΌμ΄μ–ΈνΈμ— μ „μ†΅ν•¨. (@Controller + @ResponseBody)
- μ£Όλ΅ API κ°λ°μ— μ‚¬μ©λλ©°, HTML λ·°λ¥Ό λ°ν™ν•μ§€ μ•μ
```
@RestController
@RequestMapping("/path1")

public class Controller() {

    // GET μ”μ²­ - ("κ²½λ΅λ” λ™μΌν•λ©΄ μƒλµκ°€λ¥")
    @GetMapping("/path2")
    public List<νƒ€μ…> list() {
        return "";
    } 

    // POST μ”μ²­ - ("κ²½λ΅λ” λ™μΌν•λ©΄ μƒλµκ°€λ¥")
    @PostMapping
    public String join(@RequestParam("id") Long id) {
        return "";
    }

    // PUT μ”μ²­ 
    @PutMapping

    // DELETE μ”μ²­
    @DeleteMapping
}
```

μ”μ²­ λ°μ΄ν„° μ²λ¦¬: @RequestBody   
- ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° μ „λ‹¬λ HTTP μ”μ²­ λ°”λ””λ¥Ό λ©”μ†λ“μ νλΌλ―Έν„°λ΅ λ§¤ν•‘
- μ£Όλ΅ JSON, XMLκ³Ό κ°™μ€ λ°μ΄ν„°λ¥Ό κ°μ²΄λ΅ λ³€ν™ν•μ—¬ μ‚¬μ© 
```
// post
// ?account=xxxx&password=xxx..... -> μ΄ λ°©λ²•μ€ λ¶νΈν•λ‹¤.
// μ „μ†΅ν•  λ°μ΄ν„°λ¥Ό JSON κ°μ²΄λ΅ λ¬¶μ–΄μ„ λ³΄λ‚΄κ³  ν’€μ–΄μ„ μ‚¬μ©

// controller 
@PostMapping("/path")
// @RequestBody μƒλµ ν•λ©΄ μ•λ¨
public String user(@RequestBody User user) {
    return "";
}

// user κ°μ²΄
import lombok.*; 

@Getter @Setter @ToString
@NoArgsConstructor
@AllArgsConstructor
@EqualsAndHashCode 

public class User {
    private String name;
    private int age;
}
```
POST μ”μ²­μ—μ„ μ…λ ¥λ°›μ€ JSONμ„ μλ°” κ°μ²΄λ΅ λ³€ν™
```
{
    "name": "taro",
    "age": 25
}
```

**λΉλ” ν¨ν„΄**   
κ°μ²΄λ¥Ό μƒμ„±ν•  λ• λ§μ€ νλΌλ―Έν„°λ¥Ό κΉ”λ”ν•κ² μ²λ¦¬ν•κ³  κ°€λ…μ„±κ³Ό μ μ§€λ³΄μλ¥Ό μΆ‹κ² ν•΄μ£Όλ” μƒμ„±ν¨ν„΄. λ³µμ΅ν• μƒμ„±μλ¥Ό λ€μ²΄ν•΄μ¤. λ΅¬λ³µμΌλ΅ μ‰½κ² κµ¬ν„ κ°€λ¥
```
// entity
punlic class Member {
    private String uid = UUID.randomUUID().toString();
    private String password;
    private String nickname;

    private Member(Builder builder) {
        this.UID = UUID.randomUUID().toString();
        this.account = builder.account;
        this.password = builder.password;
        this.nickname = builder.nickname;
    }

    // λ‚΄λ¶€ ν΄λμ¤
    public static class Builder {
        // μ›λ³Έ ν΄λμ¤λ‘ μ™„λ²½ν•κ² λ™μΌν•κ² κµ¬μ„±
        private String uid;
        private String account;
        private String password;
        private String nickname;

        public Builder() {}

        // ν•„λ“λ¥Ό μ΄κΈ°ν™”ν•λ” Setterλ¥Ό μκΈ° ν•„λ“λ…κ³Ό λ™μΌν•κ² μƒμ„±
        public Builder account(String account) {
            // μκΈ°μμ‹  κ°μ²΄λ¥Ό λ¦¬ν„΄
            this.account = account;
            return this;
        }
        public Builder password(String password) {
            this.password = password;
            return this;
        }
        public Builder nickname(String nickname) {
            this.nickname = nickname;
            return this;
        }

        // μµμΆ…μΌλ΅ μ›λ³Έ κ°μ²΄λ¥Ό λ¦¬ν„΄
        public Member build() {
            return new Member(this);
        }
    }
} 
>> μ΄κ±Έ λ΅¬λ³µ @Builderλ¥Ό μ‚¬μ©ν•μ—¬ κ°„λ‹¨ν•κ² κµ¬ν„ν•  μ μλ‹¤.
@Builder
punlic class Member {
    private String uid = UUID.randomUUID().toString();
    private String password;
    private String nickname;
}

// entity λ°”κΉ¥
Member member = new Member --> μƒμ„±μλ΅ μΈμ¤ν„΄μ¤ μƒμ„±
Member member = Member.builder()
                .account("")
                .password("")
                .nickname("")
                .build();
```
**Cors**   
μ „μ—­ ν¬λ΅μ¤ μ¤λ¦¬μ§„ μ„¤μ •: νΉμ • ν΄λΌμ΄μ–ΈνΈ APIλ¥Ό μ‚¬μ©ν•κΈ° μ„ν• μ •μ±… μ„¤μ •
```
@Configuration
public class CorsConfig implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry
                // μ”μ²­μ„ ν—μ©ν•  μ„λ²„μ URL
                .addMapping("/api/**")
                // .addMapping("/api/v3-3/members");
                // μ–΄λ–¤ ν΄λΌμ΄μ–ΈνΈλ¥Ό ν—μ©ν•  κ²ƒμΈμ§€
                .allowedOrigins("http://127.0.0.1:5500"/*, "..."*/)
                // μ–΄λ–¤ μ”μ²­ λ°©μ‹μ„ ν—μ©ν•  μ§€
                .allowedMethods("GET", "POST") // "*" μ „λ¶€ μ„¤μ •
                .allowedHeaders("*");
    }
}
```
**RequestEntity**   
Http μ‘λ‹µ μ „μ²΄λ¥Ό μ μ–΄ν•  μ μλ” μ μ—°ν• κ°μ²΄μ΄λ©° μ£Όλ΅ λ‹¤μκ³Ό κ°™μ€ μƒν™©μ—μ„ μ‚¬μ©λλ‹¤
- νΉμ • μƒνƒ μ½”λ“λ¥Ό μ„¤μ •ν•κ³  μ‹¶μ„ λ•
- μ¶”κ°€μ μΈ μ‘λ‹µ ν—¤λ”λ¥Ό μ„¤μ •ν•κ³  μ‹¶μ„ λ•
- λ³Έλ¬Έ μ—†μ΄ μƒνƒ μ½”λ“λ§ λ°ν™ν•κ³  μ‹¶μ„ λ•   

λ¨λ“  ν•Έλ“¤λ¬ λ©”μ†λ“μ νƒ€μ…μ€ RequestEntity<?>λ΅ μ‘μ„±   
νƒ€μ…μ„ μ •ν™•ν•κ² μ•„λ” κ²½μ°λ” λ…ν™•ν• νƒ€μ…μ„ λ…μ‹ 
```
@GetMapping
public ResponseEntity<?> list() {
    return ResponseEntity
            .status() // μƒνƒμ •λ³΄
            .headers() // ν—¤λ”
            .body() // λ°”λ””
}
```
statusμ— μ‚¬μ©ν•  μ μλ” μƒνƒ μ •λ³΄   
- 200 -> .ok()
- 400 -> badRequest()
- 404 -> .notFound(), notFound()λ” λ’¤μ— .body()λ¥Ό μ‚¬μ©ν•  μ μ—†λ‹¤. κµ¬ν„λμ–΄ μμ§€μ•μ
- 500 -> internalServerError()   
.status() () μ•μ— μ§μ ‘ μ‘μ„±λ„ κ°€λ¥ν•λ‹¤.

```
// ResponseEntity ν—¤λ” μ‚¬μ©λ°©λ²•
HttpHeaders httpHeaders = new HttpHeaders();
httpHeaders.add("key", "value") // λ§µ, λ¦¬μ¤νΈ μ²λΌ μ‚¬μ© κ°€λ¥
```

**Model**   
Spring MVCμ—μ„ μ»¨νΈλ΅¤λ¬μ™€ λ·° κ°„ λ°μ΄ν„°λ¥Ό μ „λ‹¬ν•κΈ° μ„ν• κ°μ²΄   
addAttribute(String key, Object value) λ©”μ†λ“λ¥Ό μ‚¬μ©ν•μ—¬ λ°μ΄ν„°λ¥Ό μ €μ¥   
```
@GetMapping
public String petPage(Model model) {
    model.addAttribute("petList", petList);
    return "/path1";
}
```   