## TIL - 2025.09.02

### 🔍 오늘 배운 내용
- action 함수
- 무한스크롤(복습)

---

#### action 함수   
loader 함수는 CRUD 중 Read 요청 처리를 담당하고   
action 함수는 Create, Update, Delete 요청 처리를 담당할 때 사용한다.   
action 함수도 loader 와 마찬가지로 라우팅 설정으로 이동하여    
api 요청을 할 페이지에 >> **action: 함수** << 을 작성한다.   
```
{
    index: true,
    element: <EventPage />,
    action: async () => {
        console.log('action 함수 실행');
    },
}
```
action 함수도 loader 함수처럼 아웃소싱도 가능하다.   
아웃소싱 한 action 함수도 라우트 설정 파일로 이동하여 임포트하고 action: 에 작성하면 된다.
```
...
{
    index: true,
    element: <EventPage />,
    action: saveAction,
}
...
```

loader 함수는 페이지가 라우팅 되는 순간 실행되지만 action 함수는 페이지가 로딩되고 바로 실행되지 않는다.   

action 함수를 실행하기 위해서는 Form 컴포넌트와 method 속성(필수 속성)을 지정해야 한다.   
method 속성에는 요청하는 Http 메소드 이름을 작성한다.(GET, POST, DELETE, PUT)
```
<Form
    method = 'POST'
    className={styles.form}
    noValidate>
    <p>
        <label htmlFor='title'>Title</label>
        <input
            id='title'
            type='text'
            name='title'
            required
            ref={titleRef}
        />
    </p>
</Form>
```
POST 요청을 보내기 위해서 form에 입력한 값을 action 함수에서 읽어와야 되는데
form 입력 값은 loader와 마찬가지로 react route가 객체 형태{context, params, request}로 제공한다.   
![alt text](/img/image-19.png)   

```
export const eventItemLoader = async (x) => {
    //const response = await fetch(`${DEFAULT_URL}/${eventId}`)
    console.log(x)
    //return response;
}
```
action 함수에서는 request를 가져온다. request안에는 요청 메소드와 formdata 등 여러 정보가 들어있다.   
입력한 정보는 request.formData()로 추출할 수 있다.
```
export const saveAction = async ({ request }) => {

    // form에 입력한 값 가져오기
    // await를 붙여서 비동기적 실행에서 순서를 보장해줌
    const formData = await request.formData();
   
    const payload = {
        title: formData.get('title'),
        desc: formData.get('description'),
        beginDate: formData.get('date'),
        imageUrl: formData.get('image')
    };
    // console.log(payload);

    const response = await fetch('http://localhost:9000/api/events', {
        method: request.method,
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
    })

    if(!response.ok) {
        throw new Error('이벤트 생성에 실패했습니다!')
    }

};
```

- useSubmit   
Form 컴포넌트 없이 action 함수를 트리거 하는 것을 낙관적 업데이트라고 부르고
useSubmit() 훅을 사용하여 action 함수를 실행시킨다.    
```
const submit = useSubmit();

const handleRemove = e => {
    // 낙관적 업데이트
    submit(null, {method:'DELETE'});
};

return (
    <>
        <button onClick={handleRemove}>Delete</button>
    </>
)
```
- redirect   
action, loader 함수 내부에서 리다이렉트를 하기 위해 사용.   
useNavigate 와 같은 훅들은 컴포넌트 아래에서만 사용할 수 있다.
```
return redirect(`/~~`) 
```

#### 무한스크롤(복습)
- 백엔드 Slice 페이징 
- 옵저버로 무한스크롤 구현

---

### 🚨 트러블슈팅
#### 🛠️ 문제와 원인
- 문제: 백엔드 @PathVariable {/id} eventId 다름 
- 원인: 

#### ✅ 해결 방법

---

#### 🛠️ 문제와 원인
- 문제: 상세페이지 단일 조회 시 서버에서 받아온 값이 아닌 html을 리턴
- 원인: fetch URL에 쌍따옴표가 잘못 들어감 ``안에 불필요한 작은따옴포가 들어가 문자열로 인식되어 요청이 잘못 날아가고   
Vite 개발 서버가 404를 처리하면서 index.html을 내려주기 때문에 HTML이 보이는 것임

#### ✅ 해결 방법