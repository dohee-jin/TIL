## TIL - 2025.09.01

### ğŸ” ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©
- ë¦¬ì•¡íŠ¸ + ë°±ì—”ë“œ í”„ë¡œì íŠ¸ ì„¤ì •
- loader 


![alt text](/img/image-19.png)   
```
export const eventItemLoader = async (x) => {
    //const response = await fetch(`${DEFAULT_URL}/${eventId}`)
    console.log(x)
    //return response;
}
```

---

#### ë¦¬ì•¡íŠ¸ + ë°±ì—”ë“œ í”„ë¡œì íŠ¸ ì„¤ì •   
ë‘ê°€ì§€ ì–¸ì–´ë¡œ í’€ìŠ¤í… í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ì¸í…”ë¦¬ì œì´ë¡œ í”„ë¡œì íŠ¸ ê¸°ë³¸ ì„¤ì •ì„ ì§„í–‰í–ˆë‹¤.   

1. ë¹ˆ í”„ë¡œì íŠ¸ ìƒì„±   

![alt text](/img/image-20.png)   

2. ëª¨ë“ˆë¡œ ë°±ì—”ë“œ / í”„ë¡ íŠ¸ì—”ë“œ í™˜ê²½ ì„¤ì •   

![alt text](/img/image-21.png)   

ëª¨ë“ˆë¡œ ê° í™˜ê²½ì— ë§ëŠ” ì„¤ì •ì„ ì§„í–‰í•˜ê³  ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ backend / frontendë¡œ í´ë” êµ¬ì¡°ë¥¼ ì„¤ì •í•˜ë©´ ëœë‹¤.

![alt text](/img/image-22.png)   

3. ë°±ì—”ë“œ ì„œë²„ í—¬ìŠ¤ ì²´í¬   
ì„œë²„ì˜ ìƒíƒœë¥¼ í™•ì¸í•  ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì‘ì„±í•˜ê³  í…ŒìŠ¤íŠ¸í•œë‹¤.   
```
@RestController
@Slf4j
public class HealthCheckController {
    @GetMapping("/status")
    public ResponseEntity<?> healthCheck() {
        return ResponseEntity.ok(
                Map.of(
                        "healthy", true,
                        "timestamp", LocalDateTime.now()
                )
        );
    }
}
```
![alt text](/img/image-23.png)   
ì´ë ‡ê²Œ jsonì´ ëœ¨ë©´ ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.   
í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ë„ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìœ¼ë©´ ê° í´ë”ì—ì„œ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ëœë‹¤.

- record   
> ë°ì´í„° ì¤‘ì‹¬ì˜ í´ë˜ìŠ¤ë¥¼ ê°„ê²°í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ì •ì˜í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ìë°”ì˜ ìƒˆë¡œìš´ ë°ì´í„° êµ¬ì¡°

record í‚¤ì›Œë“œë¡œ ì •ì˜ë˜ëŠ” í´ë˜ìŠ¤ë¡œ ë¶ˆë³€ì„±ì„ ê°€ì§„ ë°ì´í„°ë¥¼ ì‰½ê²Œ ë‹¤ë£° ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.  
ë ˆì½”ë“œëŠ” DToë¥¼ ë” ê°„ë‹¨í•˜ê³  ì•ˆì „í•˜ê²Œ ì •ì˜í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆë‹¤.   
ëª¨ë“  í•„ë“œê°€ finalì´ë©° getter, setter, toString, hasCode ë“±ì„ ìë™ìœ¼ë¡œ ìƒì„±í•´ ì¤€ë‹¤.   

ë ˆì½”ë“œì˜ í•„ë“œëŠ” ë©”ì†Œë“œì˜ ë§¤ê°œë³€ìˆ˜ ì²˜ëŸ¼ ()ì•ˆì— ì‘ì„±í•˜ë©° ëª¨ë“  í•„ë“œëŠ” private finalë¡œ ì„ ì–¸ëœë‹¤.
```
@Builder
public record EventResponse(
        String eventId,
        String title,
        @JsonFormat(pattern = "yyyy-MM-dd")
        LocalDate startDate,
        String imgUrl
) {

    // ì—”í„°í‹°ë¥¼ Dtoë¡œ ë°”ê¿”ì£¼ëŠ” í¸ì˜ ë©”ì†Œë“œ
    public static EventResponse from(Event event) {
        return EventResponse.builder()
                .eventId(event.getId().toString())
                .imgUrl(event.getImage())
                .title(event.getTitle())
                .startDate(event.getDate())
                .build();
    }
}
```
.getTitle() .get... ()ìœ¼ë¡œ ì‚¬ìš©í•˜ë˜ getterë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ëŠ”ë°   
.title(), ..() ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

---

#### loader
ì €ì¥ëœ ë°ì´í„°ë¥¼ í”„ë¡ íŠ¸ì—”ë“œë¡œ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ api í˜¸ì¶œì„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‹¤í–‰í–ˆë‹¤.   
```
const EventPage = () => {
    const [eventList, setEventList] = useState([]);

    const fetchEvent = async () => {
        const response =  await fetch(`${DEFAULT_URL}`);
        const data = await response.json();

        console.log(data);

        setEventList(data);
    }

    ...
}
```
fetchEvent()ë¥¼ ì»´í¬ë„ŒíŠ¸ ì•ˆì—ì„œ ì§ì ‘ í˜¸ì¶œí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œì ì´ ë°œìƒí•œë‹¤.   
ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ -> fetchEvent() ì‹¤í–‰ -> setEventList()ë¡œ ë‹¤ì‹œ ë Œë”ë§ ->
ë‹¤ì‹œ api ìš”ì²­ -> setEventList() ... ë¬´í•œ ë£¨í”„ ë°œìƒ. 

ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ useEffect ì•ˆìœ¼ë¡œ ì˜®ê²¨ í˜ì´ì§€ ë¡œë”© ì‹œ í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ ë³€ê²½í–ˆë‹¤.   
```
useEffect(() => {
   fetchEvent();
},[])
```
ê·¸ëŸ¬ë‚˜ useEffectë¥¼ ì‚¬ìš©í•˜ë©´ ì»´í¬ë„ŒíŠ¸ê°€ ë¨¼ì € ë Œë”ë§ëœ í›„ì— API í˜¸ì¶œì´ ì‹¤í–‰ë˜ë¯€ë¡œ,      
![alt text](/img/image-24.png)

í˜¸ì¶œë˜ëŠ” ë™ì•ˆ ì´ˆê¸° í™”ë©´(ë¹ˆ í™”ë©´)ì´ ì ì‹œ ë…¸ì¶œë  ìˆ˜ ìˆì–´ ì‚¬ìš©ì ê²½í—˜ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆë‹¤. 

- loader í•¨ìˆ˜   
**loader í•¨ìˆ˜**ë¥¼ ì‚¬ìš©í•˜ë©´ í˜ì´ì§€ê°€ ë Œë”ë§ ë˜ê¸° ì „ì— ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.   
ë¡œë” í•¨ìˆ˜ëŠ” í˜ì´ì§€ê°€ ë¼ìš°íŒ… ë  ë•Œ ì‹¤í–‰ ë˜ê¸° ë•Œë¬¸ì— ë¼ìš°í„° ì„¤ì •ìœ¼ë¡œ ì´ë™í•˜ì—¬   
api ìš”ì²­ì„ í•  í˜ì´ì§€ì— >> **loader: í•¨ìˆ˜** << ì„ ì‘ì„±í•œë‹¤.
```
...
{
    index: true,
    element: <EventPage />,
    loader: async () => {
        const res = await fetch(`http://localhost:9000/api/events`);
        return res;
    },
}
...
```
ë¡œë”ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ await response.json()ë¥¼ ì‹¤í–‰í•˜ì—¬ ì½”ë“œë¥¼ ë” ê°„ê²°í•˜ê³  í¸ë¦¬í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.   
ë˜í•œ, ë¡œë”ê°€ ë¦¬í„´í•œ ë°ì´í„°ëŠ” ë¼ìš°íŒ…ëœ í˜ì´ì§€ì™€ ê·¸ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì–¸ì œë“  ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.   

- loader í•¨ìˆ˜ ì‘ì„± ì‹œ ì£¼ì˜í•  ì    
    1. í•­ìƒ Promiseë¥¼ ë°˜í™˜í•´ì•¼ í•¨. -> í•­ìƒ ë¦¬í„´ì´ ìˆì–´ì•¼ í•¨
    2. ì—ëŸ¬ ì²˜ë¦¬ í•„ìš” -> ErrorElementì™€ ì—°ê³„í•˜ì—¬ ì‚¬ìš©
    3. ê³¼ë„í•œ ë°ì´í„° ë¡œë”© ì£¼ì˜ -> í•„ìš”í•œ ë°ì´í„°ë§Œ ë¡œë”©

- useLoaderData   
ë¡œë”ì—ì„œ ë¦¬í„´í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.    
```
const eventList = useLoaderData();
```

- loader ì•„ì›ƒì†Œì‹±   
ë¡œë”ë¥¼ ì—¬ëŸ¬ ê°œ ì‚¬ìš©í•˜ë‹¤ë³´ë©´ route ì„¤ì •íŒŒì¼ì´ ê¸¸ì–´ì§€ê³ , ì½”ë“œ ê´€ë¦¬ì™€ ì¬ì‚¬ìš©ì´ ì–´ë ¤ì›Œì§€ê³  ê°€ë…ì„±ì´ ë–¨ì–´ì§€ê²Œ ë˜ëŠ”ë° ë¡œë”ë§Œ ê´€ë¦¬í•˜ë„ë¡ íŒŒì¼ì„ ë¶„ë¦¬í•˜ì—¬ ì•„ì›ƒì†Œì‹±ì„ í•œë‹¤.   
loader í´ë”ë¥¼ ìƒì„±í•˜ê³  loader.js íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ì•ˆì— ë¡œë” ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.
```
export const eventListLoader = async () => {
    const response = await fetch(`http://localhost:9000/api/events`);
    return response;
}
```
ì•„ì›ƒì†Œì‹±í•œ ë¡œë”ë¥¼ ë¼ìš°í„° ì„¤ì •íŒŒì¼ë¡œ ì„í¬íŠ¸í•˜ì—¬ loader: ì— ì‘ì„±í•˜ë©´ ëœë‹¤.

```
...
{
    index: true,
    element: <EventPage />,
    loader: eventListLoader,
}
...
```

- loader ë™ì  íŒŒë¼ë¯¸í„° ì²˜ë¦¬   
react routerëŠ” ë¡œë”ì—ê²Œ ê°ì²´ë¡œ ì„¸ê°€ì§€ ì •ë³´: context, params, request ë¥¼ ì „ë‹¬í•˜ëŠ”ë°   
params ë¥¼ í†µí•´ íŒŒë¼ë¯¸í„°ë¡œ ì‚¬ìš©ë˜ëŠ” id ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
```
export const eventItemLoader = async ({ params }) => {
    const response = await fetch(`http://localhost:9000/api/events/${params.eventId}`)
    return response;
}
```

